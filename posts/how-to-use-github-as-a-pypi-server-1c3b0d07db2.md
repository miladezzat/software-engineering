---
card: "https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg"
tags: [Python]
description: "I was looking for a hosted private PyPi Python Package server"
author: "Milad E. Fahmy"
title: "How to use GitHub as a PyPi server"
created: "2021-08-16T15:40:09+02:00"
modified: "2021-08-16T15:40:09+02:00"
---
<div class="site-wrapper">
<main id="site-main" class="site-main outer">
<div class="inner">
<article class="post-full post tag-python tag-git tag-tech tag-programming tag-github ">
<header class="post-full-header">
<h1 class="post-full-title">How to use GitHub as a PyPi server</h1>
</header>
<figure class="post-full-image">
<picture>
<source media="(max-width: 700px)" sizes="1px" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 1w">
<source media="(min-width: 701px)" sizes="(max-width: 800px) 400px,
(max-width: 1170px) 700px,
1400px" srcset="https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg 300w,
https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg 600w,
https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg 1000w,
https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg 2000w">
<img onerror="this.style.display='none'" src="https://cdn-media-1.freecodecamp.org/images/1*E3Pn3GrE2DBJRBV8r1W__w.jpeg" alt="How to use GitHub as a PyPi server">
</picture>
</figure>
<section class="post-full-content">
<div class="post-content">
<p>I was looking for a hosted private PyPi Python Package server, that used credentials that the team already has (such as GitHub).</p><p>I didn’t want to create an on-premises server. For us, it would make it impossible to use cloud-based build servers, and it is another moving part that can go wrong. There are also potential issues with fine-grained security and speed. (We have a worldwide team, so serving the content via a <a href="https://www.webopedia.com/TERM/C/CDN.html" rel="noopener">CDN</a> would be helpful.)</p><p>I didn’t want to force the team to create accounts with another provider. They already have Active Directory and GitHub accounts. It is an annoyance for them and creates a governance burden for me.</p><p>Sadly, I couldn’t find such a service. <a href="https://gemfury.com/" rel="noopener">GemFury</a> is excellent but doesn't support GitHub authorization (at the team / organisation level) and <a href="https://www.packagr.app" rel="noopener">Packagr </a>doesn’t support GitHub authorisation at all. <a href="https://docs.myget.org/" rel="noopener">MyGet</a> is also excellent, it does allow me to use GitHub authorization, but doesn’t host Python packages. Azure DevOps has something that looks promising, but it’s in <a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/quickstarts/python-packages?view=vsts" rel="noopener">private beta</a> at the moment.</p><p>Happily, this is possible using cloud Git repositories such as GitHub, GitLab and BitBucket.</p><h3 id="pip-can-install-packages-from-git">Pip can install packages from Git</h3><p>I have hosted a Python package on GitHub (<a href="https://github.com/ceddlyburge/python_world" rel="noopener">python_world</a>), which you can install with the following command (make sure you trust me before running this command and installing my code on your computer).</p><p><code>pip install git+https://github.com/ceddlyburge/python_world#egg=python_world</code></p><p>Pip provides options to install from head, from a branch, from a tag or from a commit. I usually tag each release and install from these tags. See the <a href="https://pip.pypa.io/en/stable/reference/pip_install/#git" rel="noopener">pip install documentation for full details</a>.</p><p>This repository is public, but it works just the same with a private repo, as long as you have permission. There is no special magic (it's a vanilla Python package) and <a href="https://github.com/ceddlyburge/python_world/blob/master/setup.py" rel="noopener">Setup.py</a> does most of the work as normal.</p><p>If you are new to creating Python Packages, the <a href="https://packaging.python.org/tutorials/packaging-projects/" rel="noopener">Packaging Python Projects tutorial</a> is worth a quick read.</p><h3 id="setuptools-can-also-install-dependencies-from-git">Setuptools can also install dependencies from Git</h3><p><a href="https://pypi.org/project/setuptools/" rel="noopener">Setuptools</a> is how most people create Python packages.</p><p>I have hosted another package on GitHub <a href="https://github.com/ceddlyburge/python_hello" rel="noopener">python_hello</a>, which depends on <a href="https://github.com/ceddlyburge/python_world" rel="noopener">python_world</a>. (I’m sure you can see where this is going.)</p><p>The relevant bits from setup.py are below. <code>install_requires</code> specifies that <code>python_world</code> is a required dependency and tells Setuptools where to find it.</p><pre><code class="language-python">install_requires=[
'python_world@git+https://github.com/ceddlyburge/python_world#egg=python_world-0.0.1',
]</code></pre><p>You can install this package using the command below. It will also download the dependent <code>python_world</code> package.</p><p><code>pip install git+https://github.com/ceddlyburge/python_hello#egg=python_hello</code></p><p>This links to a specific version of <code>python_world</code>, which is a shame as it means that pip can't do any dependency management (such as working out an acceptable version if multiple things are reliant on it). However, by the end of this article, we will have removed the need for the specific link.</p><h3 id="python-environments">Python environments</h3><p>As everyone who has used Python without an environment knows, environments save a lot of frustration and wasted time. So we need to support those.</p><p>I have created a repo (<a href="https://github.com/ceddlyburge/python_use_hello_world" rel="noopener">use-hello-world</a>) that defines <code>python_hello</code> as a dependency in <a href="https://github.com/ceddlyburge/python_use_hello_world/blob/master/requirements.txt" rel="noopener">requirements.txt</a> for <a href="https://virtualenv.pypa.io/" rel="noopener">Virtualenv</a>, and <a href="https://github.com/ceddlyburge/python_use_hello_world/blob/master/environment.yml" rel="noopener">environment.yml</a> for <a href="https://www.anaconda.com" rel="noopener">Conda</a>.</p><p>If you download the repo, you can install the dependencies into a virtualenv with the following command.</p><p><code>pip install -r requirements.txt</code></p><p>If you are using conda you can use this command:</p><p><code>conda env create -n use-hello-world</code></p><h3 id="pypi-index">PyPi Index</h3><p>So far we are able to install packages from our private Git repositories. These packages can, in turn, define dependencies to other private repositories. There still isn’t a PyPi server in sight.</p><p>We could stop at this point. However, the syntax for defining dependencies is a bit mysterious. It would be difficult for the team to discover which packages are available, and we are linking to specific versions of dependent packages, instead of letting pip manage it.</p><p>To fix this we can set up a PyPi index that conforms to <a href="https://www.python.org/dev/peps/pep-0503" rel="noopener">Pep 503</a>. This specification is quite simple, and I have just created the index by hand. If this becomes too cumbersome I can generate it from the GitHub API.</p><p>I created this <a href="https://ceddlyburge.github.io/python-package-server/" rel="noopener">PyPi Index</a> using GitHub Pages. There are equivalent things for GitLab and BitBucket. You can see that the <a href="https://github.com/ceddlyburge/python-package-server/" rel="noopener">source code</a> is very simple. GitHub Pages sites are always public (and there is probably no sensitive information in your index). However, if you need them to be private you can use a service such as <a href="https://www.privatehub.cloud/" rel="noopener">PrivateHub</a>.</p><p>One thing to look out for is the <a href="https://www.python.org/dev/peps/pep-0503/#normalized-names" rel="noopener">name normalisation</a> of the specification. This requires the <code>python_hello</code> package information to be present at <code>python-hello/index.html</code> (note the change from an underscore to a dash).</p><p>Now that we have a PyPi server, we can install packages using the command below.</p><p><code>pip install python_hello --extra-index-url <a href="https://ceddlyburge.github.io/python-package-server/" rel="noopener">https://ceddlyburge.github.io/python-package-server/</a></code></p><p>So that you can see this working with environments, I have created another repo (<a href="https://github.com/ceddlyburge/python_use_hello_world_from_server" rel="noopener">use_hello_world_from_server</a>) that defines the <code>python_hello</code> dependency using this PyPi index instead of direct GitHub Links. If you are trying it with Conda, version &gt;4.4 is required.</p><p>At this point, we can go back and remove the direct Git link in <a href="https://github.com/ceddlyburge/python_hello_world/blob/master/setup.py" rel="noopener">install_requires in setup.py of python_hello</a> (as Setuptools will be able to find it from our server).</p><h3 id="conclusions">Conclusions</h3><p>Using a cloud-hosted Git provider as a PyPi server is a viable option. If you are already using one, that means that you can reuse the credentials and permissions that you already have. It will work with Cloud build servers and is likely to be provided via a CDN, so will be fast worldwide. It requires more knowledge to set up than a hosted server, but probably the same or less than hosting your own server on premises.</p><h3 id="hints-and-tips">Hints and tips</h3><p>Serving the index locally can help to troubleshoot problems (such as name normalization). It’s easy to see what requests are being made. You can use the inbuilt python HTTP server for this (<code>python -m Http.Server -8000</code>). This led me to find out that <code>pip search</code> uses <code>post</code>requests, so won’t work with GitHub pages.</p><p>You can run <code>python setup.py -install</code> to check your pip packages locally, before pushing them to Git.</p>
</div>
<hr>
<hr>
</section>
</article>
</div>
</main>
</div>
<!-- Google Tag Manager (noscript) -->
<!-- End Google Tag Manager (noscript) -->
